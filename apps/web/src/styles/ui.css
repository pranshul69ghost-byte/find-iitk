/* v3 UI overhaul: header stability, responsive layout, polished dialog, robust themes */
:root{
  /* brand + categories */
  --sell:#2563eb; --lost:#f97316; --found:#16a34a;
  /* surfaces */
  --bg:#f7f8fb; --card:#ffffff; --elev:#ffffff;
  --nav-bg: rgba(255,255,255,.92);
  --border:#e5e7eb; --chip:#f3f4f6; --hover:#f1f5f9;
  /* text */
  --text:#0f172a; --muted:#6b7280;
  /* accents */
  --focus:#93c5fd;
  /* shape + fx */
  --r:14px; --r-sm:12px; --shadow:0 6px 24px rgba(2,18,64,.06);
  /* chat height */
  --chat-h: 520px;
}
@media (max-width: 900px){ :root{ --chat-h: 420px; } }

[data-theme="dark"]{
  --sell:#60a5fa; --lost:#fb923c; --found:#34d399;
  --bg:#0b1220; --card:#0f1629; --elev:#121a2f;
  --nav-bg: rgba(15,22,41,.85);
  --border:#1f2a44; --chip:#111a2d; --hover:#0d1528;
  --text:#e5e7eb; --muted:#9ca3af; --focus:#2563eb;
}

[data-theme="midnight"]{
  --sell:#7c3aed; --lost:#f59e0b; --found:#10b981;
  --bg:#0b0f1a; --card:#0e1424; --elev:#11182b;
  --nav-bg: rgba(14,20,36,.85);
  --border:#1a2339; --chip:#0f1629; --hover:#0e162b;
  --text:#e5e7eb; --muted:#95a0b7; --focus:#8b5cf6;
}

[data-theme="ocean"]{
  --sell:#0ea5e9; --lost:#f59e0b; --found:#22c55e;
  --bg:#07131e; --card:#0a1826; --elev:#0d1d2d;
  --nav-bg: rgba(10,24,38,.85);
  --border:#123248; --chip:#0b2034; --hover:#0b2034;
  --text:#e6f3ff; --muted:#9fc3da; --focus:#38bdf8;
}
[data-theme="grape"]{
  --sell:#8b5cf6; --lost:#fb923c; --found:#34d399;
  --bg:#0f0a1a; --card:#140f24; --elev:#17122b;
  --nav-bg: rgba(20,15,36,.85);
  --border:#251c47; --chip:#160f2a; --hover:#1a1230;
  --text:#eee9ff; --muted:#b8a9e6; --focus:#a78bfa;
}
[data-theme="forest"]{
  --sell:#22c55e; --lost:#f59e0b; --found:#10b981;
  --bg:#06120d; --card:#0b1a14; --elev:#0e2119;
  --nav-bg: rgba(11,26,20,.85);
  --border:#163527; --chip:#0b1f17; --hover:#0d241b;
  --text:#e7fff3; --muted:#9ad5bf; --focus:#34d399;
}
[data-theme="sunset"]{
  --sell:#f97316; --lost:#ef4444; --found:#22c55e;
  --bg:#170a07; --card:#1f0e0a; --elev:#24110c;
  --nav-bg: rgba(31,14,10,.85);
  --border:#3b1b13; --chip:#25100c; --hover:#2a140f;
  --text:#fde2d2; --muted:#f2b39c; --focus:#fb923c;
}

*{box-sizing:border-box}
html,body,#root{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;text-rendering:optimizeLegibility}
img{max-width:100%;display:block}
a{color:inherit}

.container{max-width:1080px;margin:auto;padding:16px}
@media (min-width: 1280px){ .container{padding:20px} }

/* Header — no flicker, consistent height, mobile-friendly */
header{
  position:sticky; top:0; z-index:30;
  background:var(--nav-bg);
  border-bottom:1px solid var(--border);
  -webkit-backdrop-filter:saturate(150%) blur(6px);
  backdrop-filter:saturate(150%) blur(6px);
  transform: translateZ(0); /* anti-flicker */
  will-change: backdrop-filter;
}
.nav{
  display:flex; gap:10px; align-items:center;
  padding:10px 16px; max-width:1080px; margin:auto; min-height:60px;
}
.brand{display:flex; gap:8px; align-items:center; text-decoration:none; color:inherit; font-weight:800; letter-spacing:.2px; white-space:nowrap}
.brand-badge{display:inline-grid; place-items:center; width:28px; height:28px; border-radius:8px; background:var(--sell); color:#fff; font-size:14px}

/* Buttons and pills */
.btn{
  display:inline-flex; gap:8px; align-items:center; justify-content:center;
  padding:10px 14px; border-radius:12px; border:1px solid var(--border);
  background:var(--card); color:var(--text); cursor:pointer; transition:.15s ease;
  box-shadow:0 1px 0 rgba(0,0,0,.02); line-height: 1;
}
.btn:hover{background:var(--hover)}
.btn:active{transform:translateY(1px)}
.btn.primary{background:var(--sell); color:#fff; border-color:transparent; box-shadow:0 6px 18px rgba(37,99,235,.25)}
.btn.ghost{background:transparent}
.pill{padding:8px 10px; border-radius:999px; border:1px solid var(--border); background:var(--card)}

/* Inputs */
input,select,textarea{
  width:100%; padding:11px 12px;
  border:1px solid var(--border); border-radius:12px; background:var(--card); color:var(--text);
  outline:none; transition:border-color .15s ease, box-shadow .15s ease, background .15s ease, color .15s ease;
}
input::placeholder, textarea::placeholder{color:var(--muted)}
input:focus,select:focus,textarea:focus{border-color:var(--focus); box-shadow:0 0 0 3px color-mix(in oklab, var(--focus) 28%, transparent)}
label{font-size:13px; color:var(--muted)}

/* Cards / grid */
.grid{display:grid; grid-template-columns:1fr; gap:14px}
@media(min-width:680px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(min-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(min-width:1200px){.grid{grid-template-columns:repeat(4,1fr)}}

.grid-2{display:grid; grid-template-columns:1fr; gap:16px}
@media(min-width:960px){.grid-2{grid-template-columns:1.2fr .8fr}}

.filters{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px}
@media(min-width:768px){.filters{grid-template-columns:repeat(6,minmax(0,1fr))}}

.card{
  background:var(--card); border:1px solid var(--border); border-radius:18px;
  box-shadow:var(--shadow); overflow:hidden;
}
.card.pad{padding:14px}
.item-img{aspect-ratio:4/3; object-fit:cover; width:100%; background:#eef2f7; border-bottom:1px solid var(--border)}
.title{font-weight:700; letter-spacing:.2px}
.muted{color:var(--muted)}
.row{display:flex; align-items:center; justify-content:space-between; gap:10px}

.badges{display:flex; gap:6px; flex-wrap:wrap}
.badge{
  display:inline-flex; align-items:center; gap:6px;
  font-size:12px; padding:4px 8px; border-radius:999px;
  background:var(--chip); border:1px solid var(--border); color:var(--text);
}
.badge.sell{background:color-mix(in oklab, var(--sell) 14%, transparent); color:var(--sell); border-color:transparent}
.badge.lost{background:color-mix(in oklab, var(--lost) 16%, transparent); color:var(--lost); border-color:transparent}
.badge.found{background:color-mix(in oklab, var(--found) 16%, transparent); color:var(--found); border-color:transparent}

.empty{padding:40px 0; text-align:center; color:var(--muted)}

.form{display:grid; gap:10px; grid-template-columns:1fr}
@media(min-width:720px){.form{grid-template-columns:1fr 1fr}}
.form .full{grid-column:1/-1}

/* Dialog — no jitter, sticky head/footer, scroll only inside, body locked */
dialog{border:none; padding:0; width:min(720px, 92vw); max-height:85vh; border-radius:18px; background:var(--elev)}
dialog::backdrop{background:rgba(3,10,27,.45)}
dialog[open]{
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
}
.modal-head{padding:14px 16px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; background:inherit; z-index:2}
.modal-body{padding:16px; overflow:auto; max-height:calc(85vh - 110px)}
.footer{display:flex; gap:8px; justify-content:flex-end; padding:14px 16px; border-top:1px solid var(--border); background:inherit; position:sticky; bottom:0}

/* Utilities */
.truncate{white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.flex{display:flex; gap:8px; align-items:center}
.chips{display:flex; gap:8px; flex-wrap:wrap}

/* ===== Mobile Responsive Core ===== */
@media (max-width: 480px){
  .container{ padding: 12px; }
  .btn{ padding: 9px 12px; border-radius: 12px; }
  input,select,textarea{ padding: 10px 11px; border-radius: 12px; }
}

/* Header: converts to mobile with drawer */
.nav-actions{ display:flex; gap:8px; align-items:center; margin-left:auto; }
.only-mobile{ display:none !important; }
.only-desktop{ display:flex !important; }
@media (max-width: 740px){
  .only-mobile{ display:flex !important; }
  .only-desktop{ display:none !important; }
}

/* Drawer */
.drawer{
  position: fixed; inset: 0 0 0 0; z-index: 50;
  display: none; /* set to flex when open */
}
.drawer.open{ display:flex; }
.drawer::before{
  content:""; position:absolute; inset:0; background:rgba(0,0,0,.4);
}
.drawer-panel{
  position:relative; margin-left:auto; height:100%; width:min(86vw, 360px);
  background:var(--card); border-left:1px solid var(--border);
  box-shadow:0 10px 40px rgba(0,0,0,.2); display:flex; flex-direction:column; padding:14px;
}

/* Filters: 1 col mobile > 2 > 3 > 6 */
.filters{ display:grid; grid-template-columns:1fr; gap:10px; }
@media (min-width: 480px){ .filters{ grid-template-columns:repeat(2, 1fr); } }
@media (min-width: 640px){ .filters{ grid-template-columns:repeat(3, 1fr); } }
@media (min-width: 860px){ .filters{ grid-template-columns:repeat(6, 1fr); } }

/* Dialog: turn into full-screen sheet on small screens */
@media (max-width: 740px){
  dialog[open]{
    top:auto; bottom:0; left:0; right:0; transform:none; width:100%; max-height:80vh;
    border-radius:18px 18px 0 0;
  }
  .modal-body{ max-height:calc(80vh - 110px); }
}

/* Chat mobile behavior with safe area */
.input-bar{
  padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px)); /* iOS safe area */
}

/* Utility: touch-friendly */
button, .btn{ touch-action: manipulation; }

/* Small screens: header buttons compress */
@media (max-width:680px){
  .nav .btn{padding:8px 10px}
  .nav .brand span:last-child{display:none} /* show only monogram on tight screens */
}

/* Fixed-height chat container */
.chat-fixed{ display:grid; grid-template-columns: 320px 1fr; gap:16px; height: var(--chat-h); }
@media(max-width:900px){ .chat-fixed{ grid-template-columns:1fr; } }

/* Left list is scrollable */
.chat-sidebar{ background:var(--card); border:1px solid var(--border); border-radius:18px; padding:14px; height:100%; overflow:auto }
.chat-list{ display:grid; gap:10px }
.chat-card{ border:1px solid var(--border); border-radius:14px; padding:10px 12px; background:var(--card); cursor:pointer }
.chat-card.active{ border-color: var(--sell) }
.chat-card-title{ font-weight:700 }
.chat-card-sub{ color:var(--muted); font-size:13px }

/* Right pane */
.chat-pane{ background:var(--card); border:1px solid var(--border); border-radius:18px; padding:0; height:100%; display:flex; flex-direction:column }
.chat-header{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border) }
.chat-name{ font-weight:800 }
.chat-sub{ color:var(--muted); font-size:13px }

/* Messages: stacked one below another with a constant gap */
.msg-list{
  flex:1; overflow:auto; padding:12px;
  display:flex; flex-direction:column; gap:8px;
  background:linear-gradient(180deg, color-mix(in oklab, var(--sell) 2%, transparent), transparent)
}
.msg-row{ display:flex; align-items:flex-end }
.msg-row.me{ justify-content:flex-end }

/* Bubbles are content-width (not full) with max-width and nice rounding */
.msg-bubble{ width:fit-content; max-width:68%; padding:8px 12px; border:1px solid var(--border); border-radius:16px }
.msg-bubble.them{ background:var(--chip); border-color:var(--border); border-top-left-radius:6px }
.msg-bubble.me{ background:color-mix(in oklab, var(--sell) 22%, transparent); border-color:transparent; color:var(--text); border-top-right-radius:6px }
.msg-text{ white-space:pre-wrap; word-break:break-word }
.msg-time{ font-size:11px; opacity:.75; margin-top:4px; text-align:right }

/* Input area fixed at bottom of pane */
.input-bar{ display:flex; gap:8px; padding:12px; border-top:1px solid var(--border) }
.input-bar input{ flex:1 }

/* Centered, small date chip with subtle lines like WhatsApp */
.date-row{
  position: sticky;
  top: 8px;
  z-index: 5;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin: 6px 0;
}
.date-row::before,
.date-row::after{
  content: "";
  flex: 1;
  height: 1px;
  background: color-mix(in oklab, var(--border) 100%, transparent);
  max-width: 140px;              /* keep lines short */
}
.date-chip{
  display: inline-block;
  padding: 2px 10px;             /* smaller pill */
  border-radius: 999px;
  font-size: 11px;               /* smaller text */
  line-height: 1.2;
  background: color-mix(in oklab, var(--chip) 80%, transparent);
  color: var(--text);
  border: 1px solid var(--border);
  box-shadow: 0 1px 6px rgba(0,0,0,.08);
}
.chat-header{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border)}
.chat-name{font-weight:800}
.chat-sub{color:var(--muted); font-size:13px}

.msg-list{flex:1; overflow:auto; padding:12px; display:grid; gap:8px; background:linear-gradient(180deg, color-mix(in oklab, var(--sell) 2%, transparent), transparent)}
.msg-row{display:flex}
.msg-row.me{justify-content:flex-end}
.msg-bubble{max-width:76%; padding:8px 12px; border:1px solid var(--border); border-radius:16px}
.msg-bubble.them{background:var(--chip); border-color:var(--border); border-top-left-radius:6px}
.msg-bubble.me{background:color-mix(in oklab, var(--sell) 22%, transparent); border-color:transparent; color:var(--text); border-top-right-radius:6px}
.msg-text{white-space:pre-wrap}
.msg-time{font-size:11px; opacity:.75; margin-top:4px; text-align:right}

.input-bar{display:flex; gap:8px; padding:12px; border-top:1px solid var(--border)}
.input-bar input{flex:1}

/* Callout banners */
.callout{
  padding:12px 14px;
  border:1px solid var(--border);
  border-radius:12px;
  background:var(--chip);
  box-shadow:0 1px 6px rgba(0,0,0,.06);
}
.callout-warn{
  background: color-mix(in oklab, var(--lost) 14%, transparent);
  border-color: color-mix(in oklab, var(--lost) 40%, var(--border));
}
.callout-ok{
  background: color-mix(in oklab, var(--found) 14%, transparent);
  border-color: color-mix(in oklab, var(--found) 40%, var(--border));
}

/* Animation */
@media (prefers-reduced-motion:no-preference){
  dialog[open]{animation:pop .12s ease-out}
  @keyframes pop{from{opacity:0; transform:translateY(4px) scale(.98)} to{opacity:1; transform:translateY(0) scale(1)}}
}